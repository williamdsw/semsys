{"version":3,"sources":["webpack:///src/app/views/persons/persons.component.html","webpack:///src/app/views/persons/persons-routing.module.ts","webpack:///src/app/views/persons/persons.component.ts","webpack:///src/app/views/persons/persons.module.ts"],"names":["PersonsComponent","PersonsRoutingModule","PersonsModule","ROUTES","path","component","translateService","storageService","personService","imageUtilService","modalService","super","this","globalHeader","loadData","hasError","person","selectedModel","showConfirm","modalTexts","confirm","title","body","asObservable","pipe","take","switchMap","result","deletePerson","getId","subscribe","showAlertSuccess","success","showAlertDanger","error","records$","findAllPersons","map","persons","dto","Object","assign","imageUrl","environment","BUCKET_BASE_URL","buildFileName","getName","setImageUrl","imageElement","document","createElement","src","addEventListener","DEFAULT_AVATAR_IMG","catchError","error$","next","handleError","loading","forChild"],"mappings":"y8CAYgB,gBACI,iBACI,iBACI,QACJ,OACA,iBACA,iBACI,eAAsB,QAAyB,OACnD,OACA,iBACI,oBAAuD,+EACnD,S,qBACJ,OACJ,OACJ,OACJ,O,0BAb2C,kCAC/B,kCAEiC,0FAEX,mCAIlB,0D,yBAbxB,gBACI,gBACI,uBAgBJ,OACJ,Q,uBAjBiD,2B,yBAHrD,cACI,sBAoBJ,Q,kBApBiC,kC,sBAwBzB,eACI,Q,wCAEH,Q,MAFG,0G,yBAFR,iBACI,uBAIJ,Q,6BAJW,iCAAiB,e,qCAQ5B,eAAO,Q,oBAAiD,OACxD,oBAAgD,2DAC5C,Q,oBACJ,O,MAHO,+DAEH,yDCvCZ,ICeaA,EDPAC,EEIAC,EFZPC,EAAiB,CACrB,CAAEC,KAAM,GAAIC,WCcDL,EAAN,a,kOAAA,U,MAAA,OAEL,WACYM,EACAC,EACFC,EACAC,EACEC,2BAEVC,cAAML,EAAkBC,EAAgBG,IAN9BJ,mBACA,EAAAC,iBACF,EAAAC,gBACA,EAAAC,mBACE,EAAAC,eAKVE,EAAKC,aAAe,4BALVH,EAPP,O,EAAA,G,EAAA,kCAgBHE,KAAKE,aAhBF,qEAqBHF,KAAKG,YACLH,KAAKE,aAtBF,+BAyBWE,cACdJ,KAAKK,cAAgBD,EAELJ,KAAKF,aAAaQ,YAAaN,KAAKO,WAAWC,QAAQC,MAAOT,KAAKO,WAAWC,QAAQE,MAC9FC,eAAgBC,KACtB,OAAAC,EAAA,GAAM,GACN,OAAAC,EAAA,GAAWC,YAAM,OACPA,EAASf,EAAKJ,cAAcoB,aAAcZ,EAAOa,SAAY,OAEvEC,UACA,WACElB,EAAKE,WACLF,EAAKF,aAAaqB,iBAAiBnB,EAAKO,WAAWa,QAAQX,MAAOT,EAAKO,WAAWa,QAAQV,OAE5F,kBAAMV,EAAKF,aAAauB,gBAAiBrB,EAAKO,WAAWe,MAAMb,MAAOT,EAAKO,WAAWe,MAAMZ,UAvC3F,iCA2Ce,WAElBV,KAAKuB,SAAWvB,KAAKJ,cAAc4B,iBAAkBZ,KACnD,OAAAa,EAAA,GAAKC,YAAO,OACHA,EAAQD,IAAMrB,YAEnB,IAAMuB,EAAM,IAAI,IAChBC,OAAOC,OAAQF,EAAKvB,GACpBJ,EAAKG,YAGL,IAAI2B,EAAWC,EAAA,EAAYC,gBAC3BF,GAAe9B,EAAKH,iBAAiBoC,cAAcN,EAAIO,WAA3C,OACZP,EAAIQ,YAAaL,GAEjB,IAAMM,EAAeC,SAASC,cAAe,OAI7C,OAHAF,EAAaG,IAAMT,EACnBM,EAAaI,iBAAiB,QAAS,kBAAMb,EAAIQ,YAAYJ,EAAA,EAAYU,sBAElEd,MAIX,OAAAe,EAAA,GAAY,kBACV1C,EAAK2C,OAAOC,SACZ5C,EAAKG,YACLH,EAAK6C,YAAa7C,EAAKO,WAAWe,MAAMb,MAAOT,EAAKO,WAAWuC,QAAQpC,MAChE,Y,2BAtER,GAA+B,K,sCAAzBtB,GAAgB,oD,uBAAhBA,EAAgB,wsB,GAAA,MFlB7B,oBACI,iBACI,eAA8B,Q,oBAA+B,OACjE,OAEA,aAEA,sB,gBAuBA,wCASA,yCAMJ,Q,mBA3CsC,+CAK5B,0CAAuB,gB,4DCI1B,IAAMC,EAAN,yB,qBAAMA,I,oDAAAA,IAAoB,SAHtB,CAAC,IAAa0D,SAASxD,IACtB,O,eEML,IAAMD,EAAN,yB,qBAAMA,I,oDAAAA,IAAa,SANf,CACP,IACA,EACA,Q","file":"x","sourcesContent":["\r\n<!-- persons -->\r\n<article class=\"card-box shadow-lg mx-auto my-md-5 my-3\">\r\n    <header>\r\n        <h1 class=\"mb-3 text-center\"> {{ globalHeader | translate }} </h1>\r\n    </header>\r\n\r\n    <hr>\r\n\r\n    <div *ngIf=\"records$ | async as persons; else spanLoading;\">\r\n        <div class=\"card-container\" *ngIf=\"!hasError;\">\r\n            <div class=\"row row-cols-1 row-cols-md-4\">\r\n                <div class=\"col mb-4\" *ngFor=\"let person of persons;\">\r\n                    <div class=\"card card-list-item\">\r\n                        <div class=\"card-header card-name\" [title]=\"person.getName ()\"> \r\n                            {{ person.getName () }} \r\n                        </div>\r\n                        <img class=\"img-fluid border-bottom\" [src]=\"person?.getImageUrl() || 'assets/images/avatar-blank.png'\" alt=\"person\">\r\n                        <div class=\"card-body\">\r\n                            <p class=\"card-text\"> {{ person.getEmail () }} </p>\r\n                        </div>\r\n                        <div class=\"card-footer p-0\">\r\n                            <button type=\"button\" class=\"btn btn-danger btn-block\" (click)=\"onDelete (person);\"> \r\n                                {{ 'global.buttons.delete' | translate }} \r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <ng-template #spanLoading>\r\n        <div class=\"bg-light p-3 text-center\">\r\n            <span *ngIf=\"!hasError; else spanError;\"> \r\n                {{ 'global.messages.loading' | translate }} \r\n                {{ 'global.menu-links.persons' | translate }} ... \r\n            [</span>\r\n        </div>\r\n    </ng-template>\r\n\r\n    <ng-template #spanError>\r\n        <span> {{ 'global.messages.system-error' | translate }} </span>\r\n        <button type=\"button\" class=\"btn btn-info mx-1\" (click)=\"onSearch ()\"> \r\n            {{ 'global.buttons.reload' | translate }} \r\n        </button>\r\n    </ng-template>\r\n</article>","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { PersonsComponent } from './persons.component';\r\n\r\nconst ROUTES: Routes = [\r\n  { path: '', component: PersonsComponent },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(ROUTES)],\r\n  exports: [RouterModule]\r\n})\r\nexport class PersonsRoutingModule { }\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { Observable, EMPTY } from 'rxjs';\r\nimport { map, take, switchMap, catchError } from 'rxjs/operators';\r\n\r\nimport { environment } from 'src/environments/environment';\r\n\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { PersonService } from 'src/app/services/domain/person.service';\r\nimport { ImageUtilService } from 'src/app/services/image-util.service';\r\nimport { ModalService } from 'src/app/services/modal.service';\r\nimport { StorageService } from 'src/app/services/storage.service';\r\n\r\nimport { PersonDTO } from 'src/app/models/domain/dto/person.dto';\r\n\r\nimport { BaseCardListComponent } from 'src/app/shared/list-table/base-card-list/base-card-list.component';\r\n\r\n@Component({\r\n  selector: 'app-persons',\r\n  templateUrl: './persons.component.html',\r\n})\r\nexport class PersonsComponent extends BaseCardListComponent<PersonDTO> implements OnInit {\r\n\r\n  constructor(\r\n    protected translateService: TranslateService,\r\n    protected storageService: StorageService,\r\n    private personService: PersonService,\r\n    private imageUtilService: ImageUtilService,\r\n    protected modalService: ModalService,\r\n  ) {\r\n    super(translateService, storageService, modalService);\r\n\r\n    // default config\r\n    this.globalHeader = 'global.menu-links.persons';\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.loadData();\r\n  }\r\n\r\n  public onUpdate(): void {}\r\n  public onSearch(): void {\r\n    this.hasError = false;\r\n    this.loadData ();\r\n  }\r\n\r\n  public onDelete(person: PersonDTO): void {\r\n    this.selectedModel = person;\r\n\r\n    const result$ = this.modalService.showConfirm (this.modalTexts.confirm.title, this.modalTexts.confirm.body);\r\n    result$.asObservable ().pipe (\r\n      take (1),\r\n      switchMap (result => {\r\n        return (result ? this.personService.deletePerson (person.getId ()) : EMPTY);\r\n      })\r\n    ).subscribe (\r\n      () => {\r\n        this.loadData ();\r\n        this.modalService.showAlertSuccess(this.modalTexts.success.title, this.modalTexts.success.body);\r\n      },\r\n      () => this.modalService.showAlertDanger (this.modalTexts.error.title, this.modalTexts.error.body)\r\n    );\r\n  }\r\n\r\n  protected loadData(): void {\r\n\r\n    this.records$ = this.personService.findAllPersons ().pipe (\r\n      map (persons => {\r\n        return persons.map ((person) => {\r\n\r\n          const dto = new PersonDTO ();\r\n          Object.assign (dto, person);\r\n          this.hasError = false;\r\n\r\n          // bucket url\r\n          let imageUrl = environment.BUCKET_BASE_URL;\r\n          imageUrl += `${this.imageUtilService.buildFileName(dto.getName())}.jpg`;\r\n          dto.setImageUrl (imageUrl);\r\n\r\n          const imageElement = document.createElement ('img');\r\n          imageElement.src = imageUrl;\r\n          imageElement.addEventListener('error', () => dto.setImageUrl(environment.DEFAULT_AVATAR_IMG));\r\n\r\n          return dto;\r\n        });\r\n      }),\r\n\r\n      catchError (() => {\r\n        this.error$.next (true);\r\n        this.hasError = true;\r\n        this.handleError (this.modalTexts.error.title, this.modalTexts.loading.body);\r\n        return EMPTY;\r\n      })\r\n    ) as Observable<PersonDTO[]>;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { PersonsRoutingModule } from './persons-routing.module';\r\n\r\nimport { SharedModule } from 'src/app/shared/shared.module';\r\n\r\nimport { PersonsComponent } from './persons.component';\r\n\r\n@NgModule({\r\n  declarations: [PersonsComponent],\r\n  imports: [\r\n    CommonModule,\r\n    PersonsRoutingModule,\r\n    SharedModule\r\n  ]\r\n})\r\nexport class PersonsModule { }\r\n"]}